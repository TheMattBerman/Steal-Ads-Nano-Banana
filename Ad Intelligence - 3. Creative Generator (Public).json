{
  "name": "Ad Intelligence - 3. Creative Generator (Public V2)",
  "nodes": [
    {
      "parameters": {},
      "id": "98cf0f1c-1973-4b16-8d2c-0dce29905a06",
      "name": "When Executed by Another Workflow",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1,
      "position": [
        -4128,
        224
      ]
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1SOr0Bxkn2Luf85EADvFdFfJbkc0kPUYbRGduKjGNieI",
          "mode": "list",
          "cachedResultName": "Big Players Ad Intelligence (Public)",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1SOr0Bxkn2Luf85EADvFdFfJbkc0kPUYbRGduKjGNieI/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1373665098,
          "mode": "list",
          "cachedResultName": "Brand_Guidelines",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1SOr0Bxkn2Luf85EADvFdFfJbkc0kPUYbRGduKjGNieI/edit#gid=1373665098"
        },
        "options": {}
      },
      "id": "d068cda0-86b7-49e6-a04b-1913b1db0bcf",
      "name": "Read Brand Guidelines",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.4,
      "position": [
        -3920,
        224
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "7rou2y9XeyGHdBO0",
          "name": "Google Sheets account matthew@emerald"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Extract Brand Info from sheet and merge with incoming ad data\nconst brandRows = $('Read Brand Guidelines').all();\nconst adData = $('When Executed by Another Workflow').first().json;\n\n// Build brand_info object from key-value pairs\nconst brandInfo = {};\n\n// DEBUG: Log what we're getting from the sheet\nconsole.log('Brand rows count:', brandRows.length);\nif (brandRows.length > 0) {\n  console.log('First row keys:', Object.keys(brandRows[0].json));\n  console.log('First row data:', JSON.stringify(brandRows[0].json));\n}\n\nbrandRows.forEach(row => {\n  const data = row.json;\n  \n  // Try multiple possible column name formats\n  // Google Sheets returns data with header names as keys\n  const key = data.Field || data.field || data.Key || data.key || data.A || data['Field'] || data['A'];\n  const value = data.Value || data.value || data.Content || data.content || data.B || data['Value'] || data['B'];\n  \n  if (key && value) {\n    // Normalize key: lowercase, replace spaces/hyphens with underscores\n    const normalizedKey = String(key).toLowerCase().replace(/\\s+/g, '_').replace(/-/g, '_');\n    brandInfo[normalizedKey] = value;\n    console.log(`Mapped: ${key} -> ${normalizedKey} = ${String(value).substring(0, 50)}...`);\n  }\n});\n\n// If we got no data from key-value format, try single row with all columns\nif (Object.keys(brandInfo).length === 0 && brandRows.length > 0) {\n  console.log('No key-value pairs found, trying column format...');\n  const data = brandRows[0].json;\n  Object.keys(data).forEach(key => {\n    if (data[key] && typeof data[key] === 'string') {\n      const normalizedKey = key.toLowerCase().replace(/\\s+/g, '_').replace(/-/g, '_');\n      brandInfo[normalizedKey] = data[key];\n    }\n  });\n}\n\n// Field mappings for normalization (map various names to standard names)\nconst fieldMappings = {\n  'brand': 'brand_name', 'name': 'brand_name', 'company': 'brand_name', 'brand_name': 'brand_name',\n  'description': 'description', 'about': 'description', 'tagline': 'tagline',\n  'target': 'target_audience', 'audience': 'target_audience', 'icp': 'target_audience', 'target_audience': 'target_audience',\n  'pain_points': 'pain_points', 'pains': 'pain_points', 'problems': 'pain_points',\n  'usps': 'key_USPs', 'key_usps': 'key_USPs', 'benefits': 'key_USPs', 'key_usps': 'key_USPs',\n  'voice': 'voice', 'tone': 'voice', 'voice_keywords': 'voice_keywords',\n  'example_headlines': 'example_headlines', 'headlines': 'example_headlines',\n  'forbidden_words': 'forbidden_words', 'forbidden_phrases': 'forbidden_words',\n  'primary_color': 'background_color', 'background_color': 'background_color',\n  'secondary_color': 'secondary_color', 'text_color': 'secondary_color',\n  'accent_color': 'accent_color', 'cta_color': 'accent_color',\n  'primary_font': 'primary_font', 'font': 'primary_font',\n  'font_fallback': 'font_fallback',\n  'typography_tracking': 'typography_tracking', 'tracking': 'typography_tracking',\n  'typography_line_height': 'typography_line_height', 'line_height': 'typography_line_height',\n  'audience_persona': 'audience_persona',\n  'content_pillars': 'content_pillars',\n  'product_name': 'product_name',\n  'website_url': 'website_url',\n  'logo_url': 'logo_url'\n};\n\n// Create normalized brand info with standard field names\nconst normalizedBrandInfo = {};\nObject.keys(brandInfo).forEach(key => {\n  const standardKey = fieldMappings[key] || key;\n  normalizedBrandInfo[standardKey] = brandInfo[key];\n});\n\nconsole.log('Final brand_info keys:', Object.keys(normalizedBrandInfo));\nconsole.log('brand_name:', normalizedBrandInfo.brand_name);\nconsole.log('pain_points:', normalizedBrandInfo.pain_points?.substring(0, 100));\n\n// Parse vision_json if it's a string\nlet visionJson = adData.vision_json;\nif (typeof visionJson === 'string' && visionJson) {\n  try { visionJson = JSON.parse(visionJson); } catch (e) { console.log('Vision JSON parse error:', e); }\n}\n\n// Parse marketing_insights if it's a string\nlet marketingInsights = adData.marketing_insights;\nif (typeof marketingInsights === 'string' && marketingInsights) {\n  try { marketingInsights = JSON.parse(marketingInsights); } catch (e) { console.log('Marketing insights parse error:', e); }\n}\n\nreturn [{\n  json: {\n    ...adData,\n    brand_info: normalizedBrandInfo,\n    vision_json: visionJson,\n    marketing_insights: marketingInsights\n  }\n}];"
      },
      "id": "496b75f8-b50f-4af7-a084-c87c95d79930",
      "name": "Extract Brand Info",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3696,
        224
      ]
    },
    {
      "parameters": {
        "jsCode": "// =============================================================================\n// STEP 1: GENERATE 3 CREATIVE CONCEPTS\n// Uses Kallaway Psychology Framework for original ideation\n// =============================================================================\n\nconst prevData = items[0].json;\n\nconst visionJson = prevData.vision_json || {};\nconst psychologyAnalysis = prevData.marketing_insights || {};\nconst competitorCopy = prevData.body_text || '';\nconst brandInfo = prevData.brand_info || {};\n\n// DEBUG: Log brand info to verify it's populated\nconsole.log('Brand info keys:', Object.keys(brandInfo));\nconsole.log('Brand name:', brandInfo.brand_name);\nconsole.log('Pain points:', brandInfo.pain_points?.substring(0, 100));\n\nconst prompt = `You are an elite advertising creative director who specializes in direct-response ads for B2B SaaS. You use the Kallaway Psychology Framework to create ads that hack human behavior.\n\n## YOUR TASK\n\nCreate 3 ORIGINAL ad concepts for the brand below. Do NOT just swap words from the competitor ad. Instead:\n1. Understand WHY the competitor's ad psychology works\n2. Apply those psychological principles to the brand's unique positioning\n3. Generate fresh, specific, concrete concepts that would make the target audience stop scrolling\n\n## COMPETITOR AD ANALYSIS\n\n**What the competitor ad said:**\n${competitorCopy}\n\n**Visual structure that worked:**\n${JSON.stringify(visionJson.composition || {}, null, 2)}\n\n**Psychology that made it effective:**\n${JSON.stringify(psychologyAnalysis, null, 2)}\n\n## BRAND CONTEXT (THIS IS WHO YOU'RE CREATING ADS FOR)\n\n**Brand:** ${brandInfo.brand_name || 'Unknown'}\n**Tagline:** ${brandInfo.tagline || ''}\n**What they do:** ${brandInfo.description || brandInfo.tagline || 'AI-powered solution'}\n**Product name:** ${brandInfo.product_name || brandInfo.brand_name || ''}\n\n**Target audience:** ${brandInfo.target_audience || 'Business owners'}\n\n**Audience persona:**\n${brandInfo.audience_persona || '- Not specified'}\n\n**Primary pain points (USE THESE - they are gold):**\n${brandInfo.pain_points || '- Not specified'}\n\n**Key USPs - specific proof points (USE THESE NUMBERS):**\n${brandInfo.key_usps || brandInfo.key_USPs || '- Not specified'}\n\n**Voice/tone:**\n${brandInfo.voice || 'professional, direct'}\n\n**Voice keywords (use these words):**\n${brandInfo.voice_keywords || ''}\n\n**Example headlines that represent the brand voice:**\n${brandInfo.example_headlines || '- Not specified'}\n\n**Forbidden words/phrases (NEVER USE):**\n${brandInfo.forbidden_words || 'None specified'}\n\n**Brand colors:**\n- Background: ${brandInfo.background_color || brandInfo.primary_color || '#0a0a0a'}\n- Text: ${brandInfo.secondary_color || '#f7f4f0'}\n- Accent (CTA): ${brandInfo.accent_color || '#FADC3C'}\n\n## KALLAWAY PSYCHOLOGY FRAMEWORK\n\n**The Four Horsemen of Desires** (every ad must promise to unlock ONE primary):\n1. ðŸ’° MONEY - Wealth, revenue, cost savings, financial freedom\n2. â° TIME - Efficiency, automation, shortcuts, freedom\n3. ðŸ’ª HEALTH - Physical, mental, longevity (rare for B2B)\n4. ðŸ† STATUS - Recognition, competitive advantage, being ahead\n\n**The Six Checkpoints** (every ad must pass ALL SIX):\n1. PAIN - Trigger and aggravate the specific pain point\n2. TRUST - Establish credibility (numbers, proof, specificity)\n3. CONTRARIAN - Offer a differentiated approach\n4. LIKABILITY - Be human, authentic, relatable\n5. REHOOK - Maintain interest through the entire ad\n6. CTA - Clear, compelling call to action\n\n**Hook Archetypes:**\n- FORTUNE TELLER: Predict a future outcome\n- MAGICIAN: Achieve the impossible\n- INVESTIGATOR: Uncover hidden truth\n- CONTRARIAN: Challenge accepted wisdom\n- TEACHER: Educational revelation\n- EXPERIMENTOR: Test with surprising results\n\n**Hook Formula (3 steps):**\n1. LEAN-IN: Pattern interrupt that grabs attention\n2. INTERJECTION: Pivot word (But, However, What if)\n3. SNAPBACK: Contrarian redirect\n\n## OUTPUT REQUIREMENTS\n\n{\n  \"concepts\": [\n    {\n      \"concept_name\": \"Short descriptive name\",\n      \"primary_horseman\": \"Money|Time|Status\",\n      \"hook_archetype\": \"Fortune Teller|Magician|Investigator|Contrarian|Teacher|Experimentor\",\n      \"hook\": {\n        \"full_hook\": \"Complete hook as it would appear\",\n        \"lean_in\": \"The attention-grabbing opener\",\n        \"interjection\": \"The pivot word/phrase\",\n        \"snapback\": \"The contrarian reframe\"\n      },\n      \"copy\": {\n        \"headline\": \"Main headline text\",\n        \"subheadline\": \"Supporting line\",\n        \"data_point\": \"Specific number/stat from brand USPs\",\n        \"cta_text\": \"Button text\",\n        \"cta_subtext\": \"Optional line below CTA\"\n      },\n      \"visual_concept\": {\n        \"description\": \"Detailed description of what the IMAGE should show\",\n        \"key_elements\": [\"List\", \"of\", \"visual\", \"elements\"],\n        \"mood\": \"The emotional tone\",\n        \"avoid\": \"What NOT to show\"\n      },\n      \"psychology_mapping\": {\n        \"pain_checkpoint\": \"How this triggers pain\",\n        \"trust_checkpoint\": \"How this builds credibility\",\n        \"contrarian_checkpoint\": \"How this differs\",\n        \"likability_checkpoint\": \"What makes this human\",\n        \"rehook_checkpoint\": \"How interest is maintained\",\n        \"cta_checkpoint\": \"Why the CTA works\"\n      },\n      \"one_sentence_summary\": \"What would someone tell a friend?\"\n    }\n  ]\n}\n\n## CRITICAL RULES\n\n1. BE SPECIFIC - \"You missed $450 this dinner service\" beats \"You're losing money\"\n2. USE THE BRAND'S ACTUAL NUMBERS - \"22% revenue increase\", \"$25-$50/call\", \"30-40% of calls missed\", \"ROI in 10 days\"\n3. USE THEIR LANGUAGE - \"recapture\", \"revenue\", \"never miss\", \"offload\", \"lift ticket\"\n4. SPEAK TO THE PERSONA - \"Operator Michael\" overwhelmed during rush, needs ROI proof fast\n5. VISUAL CONCEPTS MUST BE GENERATABLE - No realistic faces. Use: phone screens with call logs, receipts showing missed revenue, POS terminals, before/after comparisons\n6. EACH CONCEPT MUST BE GENUINELY DIFFERENT - Different hook archetype, different visual approach\n7. AVOID FORBIDDEN WORDS - No \"revolutionary\", \"game-changer\", \"cutting-edge\", \"innovative solution\"\n\nOutput ONLY the JSON object.`;\n\nconst requestBody = {\n  model: \"anthropic/claude-sonnet-4.5\",\n  messages: [{ role: \"user\", content: prompt }],\n  max_tokens: 4000,\n  temperature: 0.8\n};\n\nreturn [{ json: { ...prevData, concept_generation_request: requestBody } }];"
      },
      "id": "98c6e424-85ab-4194-8a83-b7adee660a98",
      "name": "Build Concept Generation Request",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3472,
        224
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://openrouter.ai/api/v1/chat/completions",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify($json.concept_generation_request) }}",
        "options": {
          "timeout": 120000
        }
      },
      "id": "f7bb590e-8e6f-44f2-a6f1-964b85069967",
      "name": "Generate Concepts (Claude)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -3248,
        224
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "FoHuYOrModyYssj3",
          "name": "OpenRouter"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const prevData = $('Build Concept Generation Request').first().json;\nconst response = items[0].json;\n\nlet concepts = [];\n\ntry {\n  const content = response.choices?.[0]?.message?.content || '';\n  const jsonMatch = content.match(/\\{[\\s\\S]*\\}/);\n  if (jsonMatch) {\n    const parsed = JSON.parse(jsonMatch[0]);\n    concepts = parsed.concepts || [];\n  }\n} catch (e) {\n  console.log('Parse error:', e.message);\n}\n\nreturn [{\n  json: {\n    ...prevData,\n    concepts,\n    concepts_raw: response.choices?.[0]?.message?.content\n  }\n}];"
      },
      "id": "e4561867-9b04-4fca-ba60-8f6ce0540c44",
      "name": "Parse Concepts Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3040,
        224
      ]
    },
    {
      "parameters": {
        "jsCode": "// =============================================================================\n// STEP 2: RANK & SELECT BEST CONCEPT\n// =============================================================================\n\nconst prevData = items[0].json;\nconst concepts = prevData.concepts || [];\nconst brandInfo = prevData.brand_info || {};\n\nif (concepts.length === 0) {\n  return [{ json: { ...prevData, error: 'No concepts to evaluate' } }];\n}\n\nconst prompt = `You are an advertising strategist who evaluates ad concepts using the Kallaway Psychology Framework.\n\n## CONCEPTS TO EVALUATE\n\n${JSON.stringify(concepts, null, 2)}\n\n## BRAND CONTEXT\n\n**Brand:** ${brandInfo.brand_name || 'Unknown'}\n**Target audience:** ${brandInfo.target_audience || 'Business owners'}\n**Primary pain points:** ${brandInfo.pain_points || 'Not specified'}\n**Key USPs:** ${brandInfo.key_USPs || brandInfo.key_usps || 'Not specified'}\n\n## SCORING CRITERIA (1-10 each)\n\n### Kallaway Six Checkpoints (40%)\n1. Pain Score - How viscerally does it trigger pain?\n2. Trust Score - How credible is the proof?\n3. Contrarian Score - How differentiated?\n4. Likability Score - How human/relatable?\n5. Rehook Score - Does it maintain interest?\n6. CTA Score - Is the CTA compelling?\n\n### Value Equation (30%)\n7. Contrast Score - Reality vs expectations?\n8. Relevance Score - How precisely targeted?\n\n### Execution (30%)\n9. Visual Feasibility - Can AI generate this? (10=simple graphics, 7-9=mockups/receipts, 4-6=scenes with people, 1-3=realistic faces)\n10. Brand Alignment - Uses actual pain points/USPs?\n11. Atomic Sharability - One sentence explanation?\n12. Scroll-Stop Power - Would this stop scrolling?\n\n## OUTPUT\n\n{\n  \"evaluations\": [\n    {\n      \"concept_name\": \"Name\",\n      \"scores\": {\n        \"pain\": 8, \"trust\": 7, \"contrarian\": 9, \"likability\": 6, \"rehook\": 7, \"cta\": 8,\n        \"contrast\": 8, \"relevance\": 9,\n        \"visual_feasibility\": 7, \"brand_alignment\": 8, \"atomic_sharability\": 9, \"scroll_stop_power\": 8\n      },\n      \"weighted_total\": 8.0,\n      \"strengths\": [\"What works\"],\n      \"weaknesses\": [\"What could improve\"]\n    }\n  ],\n  \"ranking\": [\n    {\"rank\": 1, \"concept_name\": \"Winner\", \"weighted_total\": 8.5}\n  ],\n  \"winner\": {\n    \"concept_name\": \"Name of winner\",\n    \"why_it_won\": \"2-3 sentence explanation\",\n    \"recommended_tweaks\": [\"Any improvements\"]\n  }\n}\n\nBe honest and critical. Output ONLY JSON.`;\n\nconst requestBody = {\n  model: \"anthropic/claude-sonnet-4.5\",\n  messages: [{ role: \"user\", content: prompt }],\n  max_tokens: 3000,\n  temperature: 0.3\n};\n\nreturn [{ json: { ...prevData, ranking_request: requestBody } }];"
      },
      "id": "34945046-72e1-490f-8b04-3cb7dfa81d91",
      "name": "Build Ranking Request",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2816,
        224
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://openrouter.ai/api/v1/chat/completions",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify($json.ranking_request) }}",
        "options": {
          "timeout": 120000
        }
      },
      "id": "0de486eb-7644-4038-ad6d-1087bd618a7c",
      "name": "Rank Concepts (Claude)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2592,
        224
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "FoHuYOrModyYssj3",
          "name": "OpenRouter"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const prevData = $('Build Ranking Request').first().json;\nconst response = items[0].json;\n\nlet ranking = {};\n\ntry {\n  const content = response.choices?.[0]?.message?.content || '';\n  const jsonMatch = content.match(/\\{[\\s\\S]*\\}/);\n  if (jsonMatch) {\n    ranking = JSON.parse(jsonMatch[0]);\n  }\n} catch (e) {\n  console.log('Parse error:', e.message);\n}\n\n// Find winning concept\nconst concepts = prevData.concepts || [];\nconst winnerName = ranking.winner?.concept_name || concepts[0]?.concept_name;\nconst winningConcept = concepts.find(c => c.concept_name === winnerName) || concepts[0];\n\nreturn [{\n  json: {\n    ...prevData,\n    ranking,\n    winning_concept: winningConcept,\n    ranking_raw: response.choices?.[0]?.message?.content\n  }\n}];"
      },
      "id": "41918578-731f-4263-9132-d909f6b488e3",
      "name": "Parse Ranking Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2368,
        224
      ]
    },
    {
      "parameters": {
        "jsCode": "// =============================================================================\n// STEP 3: CONSTRUCT IMAGE SPEC JSON\n// =============================================================================\n\nconst prevData = items[0].json;\n\nconst winningConcept = prevData.winning_concept || {};\nconst ranking = prevData.ranking || {};\nconst visionJson = prevData.vision_json || {};\nconst brandInfo = prevData.brand_info || {};\n\nconst prompt = `You are a technical art director converting a creative concept into an image generation specification.\n\n## WINNING CONCEPT\n\n${JSON.stringify(winningConcept, null, 2)}\n\n## RECOMMENDED TWEAKS\n\n${JSON.stringify(ranking.winner?.recommended_tweaks || [], null, 2)}\n\n## COMPETITOR'S VISUAL STRUCTURE (Layout reference)\n\n${JSON.stringify(visionJson.composition || {}, null, 2)}\n\n## BRAND STYLING (MUST USE EXACTLY)\n\n**Colors:**\n- Background: ${brandInfo.background_color || '#0a0a0a'}\n- Primary text: ${brandInfo.secondary_color || '#f7f4f0'}\n- Accent/CTA: ${brandInfo.accent_color || '#FADC3C'}\n${brandInfo.accent_color_orange ? `- Orange: ${brandInfo.accent_color_orange}` : ''}\n${brandInfo.accent_color_blue ? `- Blue: ${brandInfo.accent_color_blue}` : ''}\n\n**Typography:**\n- Font: ${brandInfo.primary_font || 'Inter'}\n- Fallback: ${brandInfo.font_fallback || 'Helvetica, sans-serif'}\n- Tracking: ${brandInfo.typography_tracking || '-2%'}\n- Line height: ${brandInfo.typography_line_height || '95%'}\n\n## OUTPUT FORMAT\n\n{\n  \"ad_concept_name\": \"Name_With_Underscores\",\n  \"file_specs\": {\n    \"dimensions\": \"1080x1920\",\n    \"format\": \"9:16 Vertical\"\n  },\n  \"brand_styling\": {\n    \"background_color\": \"#0a0a0a\",\n    \"primary_accent_color\": \"#FADC3C\",\n    \"secondary_accent_color\": \"#f7f4f0\",\n    \"primary_font\": \"Font name\",\n    \"typography_treatment\": \"Bold headlines, clean body\"\n  },\n  \"layout_layers\": [\n    {\n      \"layer_name\": \"Headline\",\n      \"type\": \"text\",\n      \"content\": \"Headline text\",\n      \"style\": { \"color\": \"#FFFFFF\", \"weight\": \"800\", \"size_px\": 72, \"alignment\": \"left\" },\n      \"position\": { \"top_px\": 120, \"left_px\": 60 }\n    },\n    {\n      \"layer_name\": \"Subheadline\",\n      \"type\": \"text\",\n      \"content\": \"Subheadline text\",\n      \"style\": { \"color\": \"#FADC3C\", \"weight\": \"600\", \"size_px\": 36 },\n      \"position\": { \"top_px\": 320, \"left_px\": 60 }\n    },\n    {\n      \"layer_name\": \"Visual_Element\",\n      \"type\": \"image_placeholder\",\n      \"position\": { \"top_px\": 450, \"center_x\": true, \"width_px\": 900, \"height_px\": 600 },\n      \"image_generation_prompt\": \"Detailed 50+ word prompt for the visual element only. Specify colors (#FADC3C yellow, #0a0a0a black), style, objects. Use 'on dark background'. NO realistic human faces.\"\n    },\n    {\n      \"layer_name\": \"Data_Point\",\n      \"type\": \"text_badge\",\n      \"content\": \"22% more revenue\",\n      \"style\": { \"color\": \"#0a0a0a\", \"background_color\": \"#FADC3C\", \"weight\": \"700\", \"size_px\": 32 },\n      \"position\": { \"top_px\": 1100, \"left_px\": 60 }\n    },\n    {\n      \"layer_name\": \"CTA_Button\",\n      \"type\": \"button\",\n      \"content\": \"Button Text\",\n      \"style\": { \"background_color\": \"#FADC3C\", \"text_color\": \"#0a0a0a\", \"weight\": \"700\", \"size_px\": 42, \"border_radius_px\": 100 },\n      \"position\": { \"bottom_px\": 120, \"center_x\": true }\n    }\n  ]\n}\n\n## RULES\n\n1. USE EXACT BRAND COLORS - Hex codes are non-negotiable\n2. PROPER LAYER POSITIONS - Headline at top, visual in middle, CTA at bottom\n3. IMAGE PROMPT - Describe visual only, not text. Specify style/colors. Use \"on dark background\"\n4. TEXT CONTENT - Use exact copy from winning concept\n5. NO REALISTIC FACES in image prompt\n6. image_generation_prompt must be 50+ words with specific details\n\nOutput ONLY the JSON object.`;\n\nconst requestBody = {\n  model: \"anthropic/claude-sonnet-4.5\",\n  messages: [{ role: \"user\", content: prompt }],\n  max_tokens: 3000,\n  temperature: 0.4\n};\n\nreturn [{ json: { ...prevData, json_construction_request: requestBody } }];"
      },
      "id": "4b6ef283-5b05-476e-b97e-20c8660a24fa",
      "name": "Build JSON Construction Request",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2160,
        224
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://openrouter.ai/api/v1/chat/completions",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify($json.json_construction_request) }}",
        "options": {
          "timeout": 120000
        }
      },
      "id": "95ec85b0-f943-4cd5-af76-bb51c298f20b",
      "name": "Construct JSON (Claude)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1936,
        224
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "FoHuYOrModyYssj3",
          "name": "OpenRouter"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const prevData = $('Build JSON Construction Request').first().json;\nconst response = items[0].json;\n\nlet imageSpec = {};\n\ntry {\n  const content = response.choices?.[0]?.message?.content || '';\n  const jsonMatch = content.match(/\\{[\\s\\S]*\\}/);\n  if (jsonMatch) {\n    imageSpec = JSON.parse(jsonMatch[0]);\n  }\n} catch (e) {\n  console.log('Parse error:', e.message);\n}\n\nreturn [{\n  json: {\n    ...prevData,\n    image_generation_prompt: imageSpec,\n    image_spec_raw: response.choices?.[0]?.message?.content\n  }\n}];"
      },
      "id": "69b95c15-4114-433b-bfe2-2ce2649e90b2",
      "name": "Parse Final JSON",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1712,
        224
      ]
    },
    {
      "parameters": {
        "jsCode": "// =============================================================================\n// Build Image Request for Gemini Image Generation - V7 FIXED\n// Removes pixel values from prompt to prevent them being rendered as text\n// =============================================================================\n\nconst prevData = items[0].json;\nconst imageGenPrompt = prevData.image_generation_prompt || {};\nconst fileSpecs = imageGenPrompt.file_specs || {};\nconst brandStyling = imageGenPrompt.brand_styling || {};\nconst layers = imageGenPrompt.layout_layers || [];\nconst brandInfo = prevData.brand_info || {};\n\n// Determine aspect ratio\nlet aspectRatio = '9:16';\nconst format = fileSpecs.format || '';\nconst dimensions = fileSpecs.dimensions || '';\n\nif (format.includes('1:1') || dimensions === '1080x1080') aspectRatio = '1:1';\nelse if (format.includes('4:5') || dimensions === '1080x1350') aspectRatio = '4:5';\nelse if (format.includes('16:9') || dimensions === '1920x1080') aspectRatio = '16:9';\n\n// Extract text content from layers\nconst headlines = [];\nconst subheadlines = [];\nlet ctaText = '';\nlet dataPoint = '';\nlet visualDescription = '';\n\nlayers.forEach(layer => {\n  const name = (layer.layer_name || '').toLowerCase();\n  const content = layer.content || '';\n  \n  if (name.includes('headline') && !name.includes('sub')) {\n    headlines.push(content);\n  } else if (name.includes('subheadline') || name.includes('sub')) {\n    subheadlines.push(content);\n  } else if (name.includes('cta') || name.includes('button')) {\n    ctaText = content;\n  } else if (name.includes('data') || name.includes('stat')) {\n    dataPoint = content;\n  } else if (layer.type === 'image_placeholder' || layer.type === 'generated_image') {\n    visualDescription = layer.image_generation_prompt || '';\n  }\n});\n\n// Build natural language prompt - NO PIXEL VALUES\nlet textPrompt = `Create a professional social media advertisement with these specifications:\n\n## IMAGE FORMAT\n- Vertical ${aspectRatio} format (${dimensions || '1080x1920'})\n- Full-screen mobile ad\n\n## BRAND COLORS (USE EXACTLY)\n- Background: ${brandStyling.background_color || brandInfo.background_color || '#0a0a0a'} (dark)\n- Accent Color: ${brandStyling.primary_accent_color || brandInfo.accent_color || '#FADC3C'} (yellow - for CTA and highlights)\n- Text: ${brandStyling.secondary_accent_color || brandInfo.secondary_color || '#FFFFFF'} (white)\n\n## CONTENT TO DISPLAY\n\n**HEADLINE (at top, large bold text):**\n${headlines.length > 0 ? headlines.join('\\n') : 'No headline'}\n\n${subheadlines.length > 0 ? `**SUBHEADLINE (below headline, accent color):**\\n${subheadlines.join('\\n')}` : ''}\n\n**VISUAL ELEMENT (center of ad):**\n${visualDescription || 'Create a relevant supporting visual'}\n\n${dataPoint ? `**DATA CALLOUT (highlighted badge):**\\n\"${dataPoint}\"\\n- Yellow background with dark text` : ''}\n\n**CTA BUTTON (bottom of ad):**\n${ctaText ? `\"${ctaText}\"` : 'Call to action'}\n- Pill-shaped button\n- Yellow background (#FADC3C) with dark text\n- Centered at bottom\n\n## DESIGN RULES\n1. Dark background throughout\n2. High contrast, readable text\n3. Clean, modern, professional look\n4. All text must be crisp and legible\n5. IMPORTANT: Do NOT include any numbers, measurements, pixel values, or technical specs as visible text\n6. Only show the headline, subheadline, data point, and CTA text specified above\n\nGenerate a complete, polished advertisement ready for social media.`;\n\nconst requestBody = {\n  model: \"google/gemini-3-pro-image-preview\",\n  messages: [{ role: \"user\", content: textPrompt }],\n  max_tokens: 4096\n};\n\nreturn [{\n  json: {\n    ...prevData,\n    image_request_body: requestBody,\n    image_prompt_text: textPrompt,\n    image_prompt_json: imageGenPrompt,\n    requested_aspect_ratio: aspectRatio\n  }\n}];"
      },
      "id": "11dd019e-bfe0-444d-91ca-8602dac7543a",
      "name": "Build Image Request",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1488,
        224
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://openrouter.ai/api/v1/chat/completions",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify($json.image_request_body) }}",
        "options": {
          "timeout": 180000
        }
      },
      "id": "29ba76df-45de-49f2-91e7-c5d8959c51ff",
      "name": "Generate Image",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1280,
        224
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "FoHuYOrModyYssj3",
          "name": "OpenRouter"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const prevData = $('Build Image Request').first().json;\nconst response = items[0].json;\n\nlet imageUrl = '';\nlet imageBase64 = '';\n\ntry {\n  // Gemini returns images in choices[0].message.images array\n  const images = response.choices?.[0]?.message?.images;\n  if (Array.isArray(images) && images.length > 0) {\n    const firstImage = images[0];\n    if (firstImage.image_url?.url) {\n      const dataUrl = firstImage.image_url.url;\n      if (dataUrl.startsWith('data:image/')) {\n        imageBase64 = dataUrl.split(',')[1];\n      } else if (dataUrl.startsWith('http')) {\n        imageUrl = dataUrl;\n      }\n    }\n  }\n  \n  // Also check content for base64 or URL\n  const content = response.choices?.[0]?.message?.content || '';\n  if (!imageBase64 && !imageUrl) {\n    const urlMatch = content.match(/https?:\\/\\/[^\\s\"']+\\.(png|jpg|jpeg|webp)/i);\n    if (urlMatch) {\n      imageUrl = urlMatch[0];\n    }\n  }\n} catch (e) {\n  console.log('Parse error:', e.message);\n}\n\nconst { image_request_body, ...cleanData } = prevData;\n\nreturn [{\n  json: {\n    ...cleanData,\n    generated_image_url: imageUrl,\n    generated_image_base64: imageBase64,\n    has_image: !!(imageBase64 || imageUrl),\n    status: imageBase64 || imageUrl ? 'GENERATED' : 'IMAGE_FAILED'\n  }\n}];"
      },
      "id": "7c69232c-11da-4992-8a7a-5a3c5bab8951",
      "name": "Parse Image Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1056,
        224
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "c1",
              "leftValue": "={{ $json.has_image }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "cc655334-74fa-420b-bce8-8413ea347036",
      "name": "Check Image Result",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -832,
        224
      ]
    },
    {
      "parameters": {
        "jsCode": "const data = items[0].json;\nconst timestamp = new Date().toISOString().replace(/[:.]/g, '-');\nconst adId = data.ad_archive_id || 'unknown';\nconst conceptName = data.winning_concept?.concept_name?.replace(/\\s+/g, '_') || 'ad';\n\nif (data.generated_image_base64) {\n  let base64Data = data.generated_image_base64;\n  if (base64Data.includes(',')) base64Data = base64Data.split(',')[1];\n  base64Data = base64Data.replace(/\\s/g, '');\n  \n  let mimeType = 'image/jpeg', ext = 'jpg';\n  if (base64Data.startsWith('iVBORw')) { mimeType = 'image/png'; ext = 'png'; }\n  \n  const filename = `${conceptName}_${adId}_${timestamp}.${ext}`;\n  const buffer = Buffer.from(base64Data, 'base64');\n  \n  return [{\n    json: { ...data, filename, detected_mime_type: mimeType, file_size_bytes: buffer.length },\n    binary: { data: { data: buffer.toString('base64'), mimeType, fileName: filename } }\n  }];\n}\n\nreturn [{ json: { ...data, filename: `${conceptName}_${adId}_${timestamp}.jpg`, error: 'No base64' } }];"
      },
      "id": "fb2a8a30-9595-4009-bf63-4392111d6988",
      "name": "Prepare for Upload",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -608,
        112
      ]
    },
    {
      "parameters": {
        "name": "={{ $json.filename }}",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "1lkrqmXwsQ__Orm7TrzY8gQi1amB6VMHV",
          "mode": "list",
          "cachedResultName": "Big Players Ad Scraping",
          "cachedResultUrl": "https://drive.google.com/drive/folders/1lkrqmXwsQ__Orm7TrzY8gQi1amB6VMHV"
        },
        "options": {}
      },
      "id": "e99b88bf-f788-44be-ac3d-011ae51a0be7",
      "name": "Upload to Google Drive",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -400,
        112
      ],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "c1lX68Ne53WW1ODn",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "operation": "share",
        "fileId": {
          "__rl": true,
          "value": "={{ $json.id }}",
          "mode": "id"
        },
        "permissionsUi": {
          "permissionsValues": {
            "role": "reader",
            "type": "anyone"
          }
        },
        "options": {}
      },
      "id": "e85e8568-f99c-4c1a-ac1f-1709ca50cffb",
      "name": "Get Shareable Link",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -176,
        112
      ],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "c1lX68Ne53WW1ODn",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1SOr0Bxkn2Luf85EADvFdFfJbkc0kPUYbRGduKjGNieI",
          "mode": "list",
          "cachedResultName": "Big Players Ad Intelligence (Public)",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1SOr0Bxkn2Luf85EADvFdFfJbkc0kPUYbRGduKjGNieI/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Competitor_Ads",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16MwvfbNAdxOdNVJ2EBua3y5LvJY7bk549VfXImSRmKI/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "ad_archive_id": "={{ $('Parse Image Response').first().json.ad_archive_id }}",
            "status": "GENERATED",
            "generated_image_url": "=https://drive.google.com/file/d/{{ $json.id }}/view",
            "generated_headlines": "={{ $('Parse Image Response').first().json.winning_concept?.copy?.headline }}",
            "generated_body_copy": "={{ $('Parse Image Response').first().json.winning_concept?.copy?.subheadline }}",
            "generated_cta": "={{ $('Parse Image Response').first().json.winning_concept?.copy?.cta_text }}",
            "generated_data_point": "={{ $('Parse Image Response').first().json.winning_concept?.copy?.data_point }}",
            "generated_hook_full": "={{ $('Parse Image Response').first().json.winning_concept?.hook?.full_hook }}",
            "generated_hook_archetype": "={{ $('Parse Image Response').first().json.winning_concept?.hook_archetype }}",
            "generated_primary_horseman": "={{ $('Parse Image Response').first().json.winning_concept?.primary_horseman }}",
            "checkpoint_pain": "={{ $('Parse Image Response').first().json.winning_concept?.psychology_mapping?.pain_checkpoint }}",
            "checkpoint_trust": "={{ $('Parse Image Response').first().json.winning_concept?.psychology_mapping?.trust_checkpoint }}",
            "ad_concept_name": "={{ $('Parse Image Response').first().json.winning_concept?.concept_name }}",
            "layer_count": "={{ $('Parse Image Response').first().json.image_generation_prompt?.layout_layers?.length }}",
            "image_prompt_json": "={{ JSON.stringify($('Parse Image Response').first().json.image_generation_prompt) }}",
            "visual_concept": "={{ $('Parse Image Response').first().json.winning_concept?.visual_concept?.description }}",
            "one_sentence_summary": "={{ $('Parse Image Response').first().json.winning_concept?.one_sentence_summary }}",
            "concept_ranking_score": "={{ $('Parse Ranking Response').first().json.ranking?.evaluations?.[0]?.weighted_total }}",
            "row_number": 0
          },
          "matchingColumns": [
            "ad_archive_id"
          ],
          "schema": [
            {
              "id": "ad_archive_id",
              "displayName": "ad_archive_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "page_id",
              "displayName": "page_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "page_name",
              "displayName": "page_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "start_date",
              "displayName": "start_date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "end_date",
              "displayName": "end_date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "run_duration_days",
              "displayName": "run_duration_days",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "is_active",
              "displayName": "is_active",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "collation_count",
              "displayName": "collation_count",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "effectiveness_score",
              "displayName": "effectiveness_score",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "body_text",
              "displayName": "body_text",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "cta_type",
              "displayName": "cta_type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "media_type",
              "displayName": "media_type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "image_url",
              "displayName": "image_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "video_url",
              "displayName": "video_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "video_thumbnail_url",
              "displayName": "video_thumbnail_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "creative_hash",
              "displayName": "creative_hash",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "last_checked",
              "displayName": "last_checked",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "vision_json",
              "displayName": "vision_json",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "marketing_insights",
              "displayName": "marketing_insights",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "generated_headlines",
              "displayName": "generated_headlines",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "generated_body_copy",
              "displayName": "generated_body_copy",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "generated_image_prompt",
              "displayName": "generated_image_prompt",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "generated_image_url",
              "displayName": "generated_image_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "publisher_platforms",
              "displayName": "publisher_platforms",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "diff_status",
              "displayName": "diff_status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "previous_hash",
              "displayName": "previous_hash",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "psychology_primary_horseman",
              "displayName": "psychology_primary_horseman",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "psychology_secondary_horseman",
              "displayName": "psychology_secondary_horseman",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "psychology_value_score",
              "displayName": "psychology_value_score",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "psychology_checkpoints_passed",
              "displayName": "psychology_checkpoints_passed",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "psychology_avg_checkpoint_score",
              "displayName": "psychology_avg_checkpoint_score",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "psychology_hook_archetype",
              "displayName": "psychology_hook_archetype",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "psychology_one_std_deviation",
              "displayName": "psychology_one_std_deviation",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "generated_hook_full",
              "displayName": "generated_hook_full",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "generated_hook_archetype",
              "displayName": "generated_hook_archetype",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "hook_type",
              "displayName": "hook_type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "generated_primary_horseman",
              "displayName": "generated_primary_horseman",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "generated_contrast_mechanism",
              "displayName": "generated_contrast_mechanism",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "quality_passes_checkpoints",
              "displayName": "quality_passes_checkpoints",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "quality_scroll_stop_power",
              "displayName": "quality_scroll_stop_power",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "quality_conversion_potential",
              "displayName": "quality_conversion_potential",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "angle",
              "displayName": "angle",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "funnel_stage",
              "displayName": "funnel_stage",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "swipe_file_notes",
              "displayName": "swipe_file_notes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "generated_cta",
              "displayName": "generated_cta",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "generated_data_point",
              "displayName": "generated_data_point",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "generated_hook_full",
              "displayName": "generated_hook_full",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "checkpoint_pain",
              "displayName": "checkpoint_pain",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "checkpoint_trust",
              "displayName": "checkpoint_trust",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "ad_concept_name",
              "displayName": "ad_concept_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "layer_count",
              "displayName": "layer_count",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "image_prompt_json",
              "displayName": "image_prompt_json",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "generated_image_url",
              "displayName": "generated_image_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "collation_id",
              "displayName": "collation_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "cta_text",
              "displayName": "cta_text",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "link_url",
              "displayName": "link_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "link_description",
              "displayName": "link_description",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "title",
              "displayName": "title",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "cards_count",
              "displayName": "cards_count",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "visual_concept",
              "displayName": "visual_concept",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "one_sentence_summary",
              "displayName": "one_sentence_summary",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "concept_ranking_score",
              "displayName": "concept_ranking_score",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {
          "cellFormat": "USER_ENTERED"
        }
      },
      "id": "e61a8007-4bd3-4985-9b16-19b7c49bcfaf",
      "name": "Update Google Sheet - Success",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.4,
      "position": [
        48,
        112
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "7rou2y9XeyGHdBO0",
          "name": "Google Sheets account matthew@emerald"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "return [{ json: { ...items[0].json, status: 'COPY_ONLY_NO_IMAGE' } }];"
      },
      "id": "adc4485a-6a9f-42ba-9e5d-e1160320bdb0",
      "name": "Skip - No Image",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -608,
        320
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1SOr0Bxkn2Luf85EADvFdFfJbkc0kPUYbRGduKjGNieI",
          "mode": "list",
          "cachedResultName": "Big Players Ad Intelligence (Public)",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1SOr0Bxkn2Luf85EADvFdFfJbkc0kPUYbRGduKjGNieI/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Competitor_Ads",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16MwvfbNAdxOdNVJ2EBua3y5LvJY7bk549VfXImSRmKI/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "ad_archive_id": "={{ $json.ad_archive_id }}",
            "status": "={{ $json.status }}",
            "generated_headlines": "={{ $json.winning_concept?.copy?.headline }}",
            "generated_body_copy": "={{ $json.winning_concept?.copy?.subheadline }}",
            "generated_cta": "={{ $json.winning_concept?.copy?.cta_text }}",
            "generated_data_point": "={{ $json.winning_concept?.copy?.data_point }}",
            "generated_hook_full": "={{ $json.winning_concept?.hook?.full_hook }}",
            "generated_hook_archetype": "={{ $json.winning_concept?.hook_archetype }}",
            "generated_primary_horseman": "={{ $json.winning_concept?.primary_horseman }}",
            "checkpoint_pain": "={{ $json.winning_concept?.psychology_mapping?.pain_checkpoint }}",
            "checkpoint_trust": "={{ $json.winning_concept?.psychology_mapping?.trust_checkpoint }}",
            "ad_concept_name": "={{ $json.winning_concept?.concept_name }}",
            "layer_count": "={{ $json.image_generation_prompt?.layout_layers?.length }}",
            "image_prompt_json": "={{ JSON.stringify($json.image_generation_prompt) }}",
            "row_number": 0
          },
          "matchingColumns": [
            "ad_archive_id"
          ],
          "schema": [
            {
              "id": "ad_archive_id",
              "displayName": "ad_archive_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "page_id",
              "displayName": "page_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "page_name",
              "displayName": "page_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "start_date",
              "displayName": "start_date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "end_date",
              "displayName": "end_date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "run_duration_days",
              "displayName": "run_duration_days",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "is_active",
              "displayName": "is_active",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "collation_count",
              "displayName": "collation_count",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "effectiveness_score",
              "displayName": "effectiveness_score",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "body_text",
              "displayName": "body_text",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "cta_type",
              "displayName": "cta_type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "media_type",
              "displayName": "media_type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "image_url",
              "displayName": "image_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "video_url",
              "displayName": "video_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "video_thumbnail_url",
              "displayName": "video_thumbnail_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "creative_hash",
              "displayName": "creative_hash",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "last_checked",
              "displayName": "last_checked",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "vision_json",
              "displayName": "vision_json",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "marketing_insights",
              "displayName": "marketing_insights",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "generated_headlines",
              "displayName": "generated_headlines",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "generated_body_copy",
              "displayName": "generated_body_copy",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "generated_image_prompt",
              "displayName": "generated_image_prompt",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "generated_image_url",
              "displayName": "generated_image_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "publisher_platforms",
              "displayName": "publisher_platforms",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "diff_status",
              "displayName": "diff_status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "previous_hash",
              "displayName": "previous_hash",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "psychology_primary_horseman",
              "displayName": "psychology_primary_horseman",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "psychology_secondary_horseman",
              "displayName": "psychology_secondary_horseman",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "psychology_value_score",
              "displayName": "psychology_value_score",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "psychology_checkpoints_passed",
              "displayName": "psychology_checkpoints_passed",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "psychology_avg_checkpoint_score",
              "displayName": "psychology_avg_checkpoint_score",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "psychology_hook_archetype",
              "displayName": "psychology_hook_archetype",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "psychology_one_std_deviation",
              "displayName": "psychology_one_std_deviation",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "generated_hook_full",
              "displayName": "generated_hook_full",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "generated_hook_archetype",
              "displayName": "generated_hook_archetype",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "hook_type",
              "displayName": "hook_type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "generated_primary_horseman",
              "displayName": "generated_primary_horseman",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "generated_contrast_mechanism",
              "displayName": "generated_contrast_mechanism",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "quality_passes_checkpoints",
              "displayName": "quality_passes_checkpoints",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "quality_scroll_stop_power",
              "displayName": "quality_scroll_stop_power",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "quality_conversion_potential",
              "displayName": "quality_conversion_potential",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "angle",
              "displayName": "angle",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "funnel_stage",
              "displayName": "funnel_stage",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "swipe_file_notes",
              "displayName": "swipe_file_notes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "generated_cta",
              "displayName": "generated_cta",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "generated_data_point",
              "displayName": "generated_data_point",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "generated_hook_full",
              "displayName": "generated_hook_full",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "checkpoint_pain",
              "displayName": "checkpoint_pain",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "checkpoint_trust",
              "displayName": "checkpoint_trust",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "ad_concept_name",
              "displayName": "ad_concept_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "layer_count",
              "displayName": "layer_count",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "image_prompt_json",
              "displayName": "image_prompt_json",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "generated_image_url",
              "displayName": "generated_image_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "collation_id",
              "displayName": "collation_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "cta_text",
              "displayName": "cta_text",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "link_url",
              "displayName": "link_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "link_description",
              "displayName": "link_description",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "title",
              "displayName": "title",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "cards_count",
              "displayName": "cards_count",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "visual_concept",
              "displayName": "visual_concept",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "one_sentence_summary",
              "displayName": "one_sentence_summary",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "concept_ranking_score",
              "displayName": "concept_ranking_score",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "id": "2597aeb9-86a0-4677-a839-1986857d5694",
      "name": "Update Sheet - Copy Only",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.4,
      "position": [
        -400,
        320
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "7rou2y9XeyGHdBO0",
          "name": "Google Sheets account matthew@emerald"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "Read Brand Guidelines",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Read Brand Guidelines": {
      "main": [
        [
          {
            "node": "Extract Brand Info",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Brand Info": {
      "main": [
        [
          {
            "node": "Build Concept Generation Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Build Concept Generation Request": {
      "main": [
        [
          {
            "node": "Generate Concepts (Claude)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Concepts (Claude)": {
      "main": [
        [
          {
            "node": "Parse Concepts Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Concepts Response": {
      "main": [
        [
          {
            "node": "Build Ranking Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Build Ranking Request": {
      "main": [
        [
          {
            "node": "Rank Concepts (Claude)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Rank Concepts (Claude)": {
      "main": [
        [
          {
            "node": "Parse Ranking Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Ranking Response": {
      "main": [
        [
          {
            "node": "Build JSON Construction Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Build JSON Construction Request": {
      "main": [
        [
          {
            "node": "Construct JSON (Claude)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Construct JSON (Claude)": {
      "main": [
        [
          {
            "node": "Parse Final JSON",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Final JSON": {
      "main": [
        [
          {
            "node": "Build Image Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Build Image Request": {
      "main": [
        [
          {
            "node": "Generate Image",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Image": {
      "main": [
        [
          {
            "node": "Parse Image Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Image Response": {
      "main": [
        [
          {
            "node": "Check Image Result",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Image Result": {
      "main": [
        [
          {
            "node": "Prepare for Upload",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Skip - No Image",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare for Upload": {
      "main": [
        [
          {
            "node": "Upload to Google Drive",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upload to Google Drive": {
      "main": [
        [
          {
            "node": "Get Shareable Link",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Shareable Link": {
      "main": [
        [
          {
            "node": "Update Google Sheet - Success",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Skip - No Image": {
      "main": [
        [
          {
            "node": "Update Sheet - Copy Only",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "324f55ac-134d-40dc-8bc4-c35a85fa1437",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "5f21038f187f7ddf12e940bb55bc64eb117a28b98f8b5539845218f69f7a8aa9"
  },
  "id": "7pSG9edVFzXkFO9W",
  "tags": []
}